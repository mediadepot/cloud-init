---
ignition:
  config: {}
  timeouts: {}
networkd: {}
passwd: {}
storage:
  directories:
  - filesystem: root
    mode: 493
    path: "/opt/mediadepot/apps/samba"
    user:
      id: 15000
    group:
      id: 15000
systemd:
  units:
  - name: samba.service
    enabled: true
    contents: |-
      [Unit]
      Description=Samba Container
      After=docker.service depot-filesystem.service media-storage.mount
      Requires=docker.service depot-filesystem.service media-storage.mount

      [Service]
      TimeoutStartSec=0
      Restart=always
      ExecStartPre=-/usr/bin/docker kill %n
      ExecStartPre=-/usr/bin/docker rm %n
      ExecStartPre=-/usr/bin/docker pull mediadepot/samba
      ExecStart=/usr/bin/docker run --rm --name %n -p 139:139 -p 445:445 -v /opt/mediadepot/apps/samba:/config -v /media:/media -e SAMBA_USERNAME=depot -e SAMBA_PASSWORD=badpass mediadepot/samba
      ExecStop=/usr/bin/docker stop -t 30 %n

      [Install]
      WantedBy=multi-user.target
